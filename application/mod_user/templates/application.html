{% extends "user.base.html" %}

{% set nav_bar = [
  ("/#home", "Home", False),
  ("/account", "Account", False),
  ("/account/application", "Application", True),
  ("/account/settings", "Settings", False),
  ("/logout", "Logout", False)
] -%}

{% block content %}
{% with nav_bar = nav_bar %}
  {% include "navbar.html" %}
{% endwith %}

{% set can_edit = (current_user.status in ["Not Started", "In Progress"]) %}
<div class="page-container">
  <div class="page-section" id="application">
    <div class="container">
      <div class="header">
        <div class="head-cover">
          <img class="logo" src="https://s3.amazonaws.com/hackbcawebsite/logo.png">
          <h2>Application</h2>
        </div>
      </div>
      <div class="info">
        <form class="application-form" method="POST" action="">
          <h4>{{ current_user.full_name() }}</h4>
          {% for field in form %}
            {{ render_field(field, not can_edit) }}
          {% endfor %}
          <div class="buttons horizontal">
            <button class="btn" type="submit" name="save" {{ "disabled" if not can_edit }}>Save</button>
            <button class="btn" onclick="verify_submit(); return false;">Submit</button>
          </div>
          <div class="buttons horizontal hide" id="verify-submit">
            <h6>Are you sure?</h6>
            <button class="btn" type="submit" name="submit" {{ "disabled" if not can_edit }}>Yes</button>
            <button class="btn" onclick="decline_verify(); return false;">No</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
  var verify_submit = function() {
    var button_group = document.getElementById("verify-submit");
    button_group.classList.toggle("hide");
  }

  var decline_verify = function() {
    var button_group = document.getElementById("verify-submit");
    button_group.classList.toggle("hide"); 
  }

  if (!Array.prototype.forEach) {
    Array.prototype.forEach = function(fun /*, thisp*/) {
      var len = this.length;
         
      if (typeof fun != "function")
      throw new TypeError();

      var thisp = arguments[1];
      for (var i = 0; i < len; i++) {
        if (i in this)
          fun.call(thisp, this[i], i, this);
      }
    };
  }

  var char_counter = function() {
    questions = document.querySelectorAll("textarea");
    console.log(questions);
    for (var i = 0; i < questions.length; i++) {
      questions[i].onkeyup = function () {
        document.querySelector(".count#" + this.id).innerHTML = "Characters left: " + (500 - this.value.length);
      }
    }
  }

  char_counter();
</script>
{% endblock %}